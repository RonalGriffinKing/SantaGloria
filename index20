<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Etiquetas App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f9f9fb; color:#000; padding-bottom:100px; }
header { background: rgba(255,255,255,0.7); backdrop-filter: blur(8px); color:#000; text-align:center; padding:12px; font-size:1.1em; font-weight:bold; position:sticky; top:0; z-index:999; }
.nav-buttons { margin-top:8px; }
.nav-buttons button { margin:0 4px; padding:6px 12px; border:none; border-radius:6px; background:#000; color:#fff; cursor:pointer; font-size:0.9em; }
.nav-buttons button:hover { background:#333; }
h1 { text-align:center; color:#000; margin:10px 0 15px; font-size:1.4em; }
label { display:block; margin-top:10px; font-weight:bold; color:#000; font-size:0.9em; }
select, input[type="text"] { width:100%; padding:12px; margin-top:6px; border-radius:6px; border:2px solid #000; font-size:1em; background:#fff; color:#000; }
#productoLista { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
.producto-btn { flex:1 1 calc(50% - 8px); background:#eee; color:#000; padding:12px; border-radius:6px; text-align:center; font-size:0.9em; cursor:pointer; user-select:none; border:1px solid #ddd; }
.producto-btn.active { background:#000; color:#fff; font-weight:bold; border:1px solid #333; }

.btn-seleccionar-todo { margin-top:10px; padding:6px 12px; border:1px solid #000; border-radius:6px; background:#fff; cursor:pointer; font-size:0.9em; }
.btn-seleccionar-todo:hover { background:#ddd; }

.fab-container { position:fixed; bottom:15px; right:15px; display:flex; flex-direction:column; gap:16px; z-index:999; align-items:center; }
.fab { color:#fff; border:none; border-radius:50%; width:60px; height:60px; font-size:24px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 3px 6px rgba(0,0,0,0.3); }
.fab:active { filter:brightness(85%); }
.fab-generar { background:#007ACC; }
.fab-label { margin-top:4px; font-size:0.8em; color:#000; font-weight:bold; text-align:center; }

.obrador-container { padding:15px; }
.obrador-item { border:1px solid #ccc; border-radius:8px; padding:10px; margin-bottom:10px; background-color:#fff; }
.obrador-item h3 { margin-top:0; font-size:1.2em; }
.obrador-item p { margin:5px 0; font-size:0.9em; }

.quick-filters { display:flex; flex-wrap:wrap; justify-content:space-around; gap:10px; margin-top:15px; }
.quick-filters button { flex:1; min-width:120px; padding:10px; border:1px solid #000; border-radius:6px; background:#fff; cursor:pointer; font-size:0.9em; font-weight:bold; display:flex; align-items:center; justify-content:center; gap:5px; }
.quick-filters button:hover { background:#eee; }
</style>
</head>
<body>

<header>
  Creado por Ronald â€“ Santa Gloria Russafa
  <div class="nav-buttons">
    <button onclick="mostrarVista('etiquetas')">ğŸ–¨ï¸ Generar</button>
    <button onclick="mostrarVista('consultar')">ğŸ“… Consultar</button>
    <button onclick="mostrarVista('obrador')">ğŸ”ª Obrador</button>
  </div>
</header>

<!-- GENERADOR -->
<div id="vista-etiquetas">
<h1>ğŸ–¨ï¸ Generador de Etiquetas</h1>
<div class="form-section" style="padding:0 15px;">
<label for="empleado">ğŸ‘¤ Â¿QuiÃ©n etiqueta?</label>
<select id="empleado"></select>
<label for="categoria">ğŸ“¦ CategorÃ­a</label>
<select id="categoria" onchange="cargarProductos()"></select>
<button class="btn-seleccionar-todo" onclick="seleccionarTodos()">âœ”ï¸ Seleccionar todo</button>
<label for="buscador">ğŸ” Buscar producto</label>
<input type="text" id="buscador" placeholder="Escribe para filtrar...">
<label>âœ”ï¸ Selecciona productos</label>
<div id="productoLista"></div>
</div>

<div class="fab-container">
  <div class="fab-group">
    <button class="fab fab-generar" onclick="generarEtiquetas()" title="Generar y descargar XLSX">ğŸ“</button>
    <div class="fab-label">Excel</div>
  </div>
</div>
</div>

<!-- CONSULTAR -->
<div id="vista-consultar" style="display:none; padding:15px;">
<h1>ğŸ“… Consulta de Caducidades</h1>
<label for="busquedaProducto">ğŸ” Buscar producto</label>
<input type="text" id="busquedaProducto" placeholder="Escribe un producto...">
<div id="resultadoConsulta" style="margin-top:15px; font-size:1em;"></div>
</div>

<!-- OBRADOR -->
<div id="vista-obrador" style="display:none;">
<div class="obrador-container">
<h1>ğŸ”ª Obrador</h1>
<label for="buscadorObrador">ğŸ” Buscar producto</label>
<input type="text" id="buscadorObrador" placeholder="Escribe para buscar...">
<div class="quick-filters">
    <button onclick="cargarProductosObradorConFiltro('croissants')">ğŸ¥ Croissants</button>
    <button onclick="cargarProductosObradorConFiltro('ensaladas')">ğŸ¥— Ensaladas</button>
    <button onclick="cargarProductosObradorConFiltro('focaccias')">ğŸ¥– Focaccias</button>
    <button onclick="cargarProductosObradorConFiltro('glorias')">âœ¨ Glorias</button>
    <button onclick="cargarProductosObradorConFiltro('sandwiches')">ğŸ¥ª Sandwiches</button>
    <button onclick="cargarProductosObradorConFiltro('bocadillos')">ğŸ¥– Bocadillos</button>
</div>
<div id="obradorLista" style="margin-top:15px;"></div>
</div>
</div>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script src="productos.js"></script>
<script>
// Variables globales
const empleados = ["Ronald","Lorena","Johnny","SofÃ­a","Claudia","Pamela","Abril","Gloria","Steven"];
const empleadoSelect = document.getElementById("empleado");
const categoriaSelect = document.getElementById("categoria");
const productoLista = document.getElementById("productoLista");
const buscadorInput = document.getElementById("buscador");

// Cargar empleados
empleados.forEach(e=>{ let opt=document.createElement("option"); opt.value=e; opt.textContent=e; empleadoSelect.appendChild(opt); });
if(localStorage.getItem("ultimoEmpleado")) empleadoSelect.value=localStorage.getItem("ultimoEmpleado");
empleadoSelect.addEventListener("change",()=>{ localStorage.setItem("ultimoEmpleado",empleadoSelect.value); });

// Cargar categorÃ­as
let categorias = Object.keys(productos);
categoriaSelect.appendChild(new Option("Todo","Todo"));
categorias.forEach(cat=>{ let opt=document.createElement("option"); opt.value=cat; opt.textContent=cat; categoriaSelect.appendChild(opt); });

// PRODUCTOS
let productButtons=[];
function cargarProductos(){
  productoLista.innerHTML=""; productButtons=[];
  const categoria=categoriaSelect.value;
  let productosMostrar=[];
  if(categoria==="Todo"){ Object.values(productos).forEach(arr=>productosMostrar=productosMostrar.concat(arr)); }
  else productosMostrar=productos[categoria]||[];
  productosMostrar.forEach(p=>{
    let btn=document.createElement("div");
    btn.className="producto-btn";
    btn.textContent=p.nombre;
    btn.dataset.nombre=p.nombre;
    btn.dataset.dias=p.dias;
    btn.dataset.tipo=(categoria==="Congelados")?"C":"R";
    btn.onclick=()=>btn.classList.toggle("active");
    productoLista.appendChild(btn);
    productButtons.push(btn);
  });
}
cargarProductos();
function seleccionarTodos(){ productButtons.forEach(btn=>btn.classList.add("active")); }
buscadorInput.addEventListener("input",()=>{
  const texto=buscadorInput.value.toLowerCase();
  productButtons.forEach(btn=>{ btn.style.display=btn.dataset.nombre.toLowerCase().includes(texto)?"block":"none"; });
});

// GENERAR Y DESCARGAR XLSX AUTOMÃTICO
function generarEtiquetas(){
  const empleado=empleadoSelect.value;
  const seleccionados=document.querySelectorAll(".producto-btn.active");
  if(seleccionados.length===0) return;

  const data = seleccionados.map(btn=>{
    const nombreProd=btn.dataset.nombre;
    const dias=parseInt(btn.dataset.dias);
    const tipo=(btn.dataset.tipo==="C")?"C":"R";
    const ahora=new Date();
    const fechaHora=ahora.toLocaleDateString("es-ES")+" "+ahora.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});
    let cad=new Date(ahora); cad.setDate(cad.getDate()+dias);
    const caducidad=dias===0?"":cad.toLocaleDateString("es-ES")+" "+cad.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});
    return {
      Producto: nombreProd,
      Tipo: tipo,
      Empleado: empleado,
      Lote: "",
      Apertura: fechaHora,
      "Cad. secundaria": caducidad
    };
  });

  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Etiquetas");
  XLSX.writeFile(wb, "etiquetas_niimbot.xlsx");
}
</script>
</body>
</html>
