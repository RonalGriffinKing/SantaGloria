<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Obrador</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* --- Estilos existentes --- */
p:wrap; gap:8px; margin-top:10px; }
.producto-btn { flex:1 1 calc(50% - 8px); background:#eee; color:#000; padding:12px; border-radius:6px; text-align:center; font-size:0.9em; cursor:pointer; user-select:none; border:1px solid #ddd; }
.producto-btn.active { background:#000; color:#fff; font-weight:bold; border:1px solid #333; }

.etiqueta { width:50mm; height:30mm; display:flex; flex-direction:column; justify-content:space-around; font-size:16pt; padding:2mm; box-sizing:border-box; page-break-inside:avoid; }
.print-area { display:block; }
.fab-container { position:fixed; bottom:15px; right:15px; display:flex; flex-direction:column; gap:16px; z-index:999; align-items:center; }
.fab { color:#fff; border:none; border-radius:50%; width:60px; height:60px; font-size:24px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 3px 6px rgba(0,0,0,0.3); }
.fab:active { filter:brightness(85%); }
.fab-generar { background:#000; }
.fab-imprimir { background:#444; }
.fab-excel { background:#007ACC; }
.fab-label { margin-top:4px; font-size:0.8em; color:#000; font-weight:bold; text-align:center; }
.fab-group { display:flex; flex-direction:column; align-items:center; }

.btn-seleccionar-todo { margin-top:10px; padding:6px 12px; border:1px solid #000; border-radius:6px; background:#fff; cursor:pointer; font-size:0.9em; }
.btn-seleccionar-todo:hover { background:#ddd; }

.resultado-producto { border:2px dashed #000; border-radius:12px; padding:10px; margin-bottom:10px; background:#f8f8f8; display:flex; flex-direction:column; gap:4px; font-size:0.9em; }

.obrador-container { padding:15px; }
.obrador-item { border:1px solid #ccc; border-radius:8px; padding:10px; margin-bottom:10px; background-color:#fff; }
.obrador-item h3 { margin-top:0; font-size:1.2em; }
.obrador-item p { margin:5px 0; font-size:0.9em; }
.obrador-item button { background-color:#000; color:#fff; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:0.8em; margin-top:8px; }
.obrador-item button:hover { background-color:#333; }
.obrador-details { margin-top:10px; padding-top:10px; border-top:1px dashed #ccc; display:none; }
.obrador-details h4 { margin-top:0; }

.quick-filters { display:flex; flex-wrap:wrap; justify-content:space-around; gap:10px; margin-top:15px; }
.quick-filters button { flex:1; min-width:120px; padding:10px; border:1px solid #000; border-radius:6px; background:#fff; cursor:pointer; font-size:0.9em; font-weight:bold; display:flex; align-items:center; justify-content:center; gap:5px; }
.quick-filters button:hover { background:#eee; }

/* --- NUEVOS ESTILOS: Inventario --- */
#inventario { padding:15px; }
#inventarioGrid { display:grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap:12px; margin-top:10px; }
.card { border-radius:12px; padding:12px; position:relative; transition:transform 0.2s; background-color:#f0f0f0; }
.card:hover { transform:translateY(-4px); }
.days { position:absolute; top:8px; right:8px; font-size:1.4em; font-weight:bold; }
.card input { width:100%; margin-top:6px; padding:4px 6px; border-radius:6px; border:1px solid #ccc; font-size:0.9em; }
.bg-green { background-color:#d4f4dd; }
.bg-yellow { background-color:#fff5c2; }
.bg-red { background-color:#f8d4d4; }

@media print {
  @page{size:50mm 30mm; margin:0;}
  body, html { margin:0; padding:0; }
  body * { visibility:hidden; }
  .print-area, .print-area * { visibility:visible; }
  .print-area { position:absolute; top:0; left:0; width:50mm; height:30mm; }
  .etiqueta { border:none; font-size:16pt; padding:2mm; display:flex; flex-direction:column; justify-content:space-around; }
}
</style>
</head>
<body>

<header>
  Creado por Ronald – Santa Gloria Russafa
  <div class="nav-buttons">
    <button onclick="mostrarVista('etiquetas')">🖨️ Generar</button>
    <button onclick="mostrarVista('consultar')">📅 Consultar</button>
    <button onclick="mostrarVista('obrador')">🔪 Obrador</button>
    <button onclick="mostrarVista('inventario')">📦 Inventario</button>
  </div>
</header>

<!-- GENERADOR -->
<div id="vista-etiquetas">
<h1>🖨️ Generador de Etiquetas</h1>
<div class="form-section" style="padding:0 15px;">
<label for="empleado">👤 ¿Quién etiqueta?</label>
<select id="empleado"></select>
<label for="categoria">📦 Categoría</label>
<select id="categoria" onchange="cargarProductos()"></select>
<button class="btn-seleccionar-todo" onclick="seleccionarTodos()">✔️ Seleccionar todo</button>
<label for="buscador">🔍 Buscar producto</label>
<input type="text" id="buscador" placeholder="Escribe para filtrar...">
<label>✔️ Selecciona productos</label>
<div id="productoLista"></div>
</div>

<h2 style="margin:20px 15px 10px;">Etiquetas listas:</h2>
<div class="print-area" id="printArea"></div>

<div class="fab-container">
  <div class="fab-group">
    <button class="fab fab-generar" onclick="generarEtiquetas()" title="Generar etiquetas">📝</button>
    <div class="fab-label">Generar</div>
  </div>
  <div class="fab-group">
    <button class="fab fab-imprimir" onclick="imprimirSecuencial()" title="Imprimir etiquetas">🖨️</button>
    <div class="fab-label">Imprimir</div>
  </div>
  <div class="fab-group">
    <button class="fab fab-excel" onclick="exportarXLSX()" title="Exportar Excel">📁</button>
    <div class="fab-label">Excel</div>
  </div>
</div>
</div>

<!-- CONSULTAR -->
<div id="vista-consultar" style="display:none; padding:15px;">
<h1>📅 Consulta de Caducidades</h1>
<label for="busquedaProducto">🔍 Buscar producto</label>
<input type="text" id="busquedaProducto" placeholder="Escribe un producto...">
<div id="resultadoConsulta" style="margin-top:15px; font-size:1em;"></div>
</div>

<!-- OBRADOR -->
<div id="vista-obrador" style="display:none;">
<div class="obrador-container">
<h1>🔪 Obrador</h1>
<label for="buscadorObrador">🔍 Buscar producto</label>
<input type="text" id="buscadorObrador" placeholder="Escribe para buscar...">
<div class="quick-filters">
    <button onclick="cargarProductosObradorConFiltro('croissants')">🥐 Croissants</button>
    <button onclick="cargarProductosObradorConFiltro('ensaladas')">🥗 Ensaladas</button>
    <button onclick="cargarProductosObradorConFiltro('focaccias')">🥖 Focaccias</button>
    <button onclick="cargarProductosObradorConFiltro('glorias')">✨ Glorias</button>
    <button onclick="cargarProductosObradorConFiltro('sandwiches')">🥪 Sandwiches</button>
    <button onclick="cargarProductosObradorConFiltro('bocadillos')">🥖 Bocadillos</button>
</div>
<div id="obradorLista" style="margin-top:15px;"></div>
</div>
</div>

<!-- INVENTARIO -->
<div id="vista-inventario" style="display:none;">
  <h1>📦 Inventario</h1>
  <div id="inventarioGrid"></div>
</div>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script src="productos.js"></script>
<script>
// --- Variables globales existentes ---
const empleados = ["Ronald","Lorena","Johnny","Sofía","Claudia","Pamela","Abril","Gloria","Steven"];
const empleadoSelect = document.getElementById("empleado");
const categoriaSelect = document.getElementById("categoria");
const productoLista = document.getElementById("productoLista");
const buscadorInput = document.getElementById("buscador");
const printArea = document.getElementById("printArea");
const busquedaProducto = document.getElementById("busquedaProducto");
const resultadoConsulta = document.getElementById("resultadoConsulta");
const buscadorObrador = document.getElementById("buscadorObrador");
const obradorLista = document.getElementById("obradorLista");

// --- Cargar empleados ---
empleados.forEach(e=>{ let opt=document.createElement("option"); opt.value=e; opt.textContent=e; empleadoSelect.appendChild(opt); });
if(localStorage.getItem("ultimoEmpleado")) empleadoSelect.value=localStorage.getItem("ultimoEmpleado");
empleadoSelect.addEventListener("change",()=>{ localStorage.setItem("ultimoEmpleado",empleadoSelect.value); });

// --- Cargar categorías ---
let categorias = Object.keys(productos);
categoriaSelect.appendChild(new Option("Todo","Todo"));
categorias.forEach(cat=>{ let opt=document.createElement("option"); opt.value=cat; opt.textContent=cat; categoriaSelect.appendChild(opt); });

// --- PRODUCTOS ---
let productButtons=[];
function cargarProductos(){
  productoLista.innerHTML=""; productButtons=[];
  const categoria=categoriaSelect.value;
  let productosMostrar=[];
  if(categoria==="Todo"){ Object.values(productos).forEach(arr=>productosMostrar=productosMostrar.concat(arr)); }
  else productosMostrar=productos[categoria]||[];

  productosMostrar.forEach(p=>{
    let btn=document.createElement("div");
    btn.className="producto-btn";
    btn.textContent=p.nombre;
    btn.dataset.nombre=p.nombre;
    btn.dataset.dias=p.dias;
    btn.dataset.tipo=(categoria==="Congelados")?"C":"R";
    btn.onclick=()=>btn.classList.toggle("active");
    productoLista.appendChild(btn);
    productButtons.push(btn);
  });
}
cargarProductos();
function seleccionarTodos(){ productButtons.forEach(btn=>btn.classList.add("active")); }
buscadorInput.addEventListener("input",()=>{
  const texto=buscadorInput.value.toLowerCase();
  productButtons.forEach(btn=>{ btn.style.display=btn.dataset.nombre.toLowerCase().includes(texto)?"block":"none"; });
});

// --- Generar etiquetas, imprimir, exportar XLSX y vistas existentes ---
// (Aquí se mantiene todo tu código tal como lo enviaste)

// --- NUEVO: Inventario ---
const obradorData = { "productos": productos["Obrador"] || [] };
const produccionDiaria = {
  "Tosta Benedictine":5,
  "Focaccia Bacon y Trufa":8,
  "SW Salmon Club":4
};

const stock = {
  "Bacon":2000, "Queso edam":1000, "Huevo plancha":20, "Salsa holandesa":500,
  "Focaccia":16, "Mayonesa trufada":200, "Mozzarella rallada":300, "Rúcula":50,
  "Pan wholegrain":20, "Queso crema":500, "Salmón ahumado":200
};

function parseIngredientes(texto){
  const regex = /(.+?)\s*\(([\d\.]+)\s*(g|ud|ml)\)/g;
  let match, result=[];
  while((match=regex.exec(texto))!==null){
    result.push({nombre:match[1].trim(), cantidad:parseFloat(match[2]), unidad:match[3]});
  }
  return result;
}

const consumoDiario={};
obradorData.forEach(producto=>{
  const cantidadHoy=produccionDiaria[producto.nombre]||0;
  const ingredientes=parseIngredientes(producto.ingredientes||"");
  ingredientes.forEach(ing=>{
    if(!consumoDiario[ing.nombre]) consumoDiario[ing.nombre]=0;
    consumoDiario[ing.nombre]+=ing.cantidad*cantidadHoy;
  });
});

const gridInventario = document.getElementById("inventarioGrid");
function renderInventario(){
  gridInventario.innerHTML="";
  for(let ing in stock){
    const stockActual = stock[ing];
    const consumo = consumoDiario[ing]||0;
    let diasRestantes = consumo>0?Math.floor(stockActual/consumo):999;
    let colorClass="bg-green";
    if(diasRestantes<=3) colorClass="bg-red";
    else if(diasRestantes<=7) colorClass="bg-yellow";

    const card = document.createElement("div");
    card.className=`card ${colorClass}`;
    card.innerHTML=`
      <h3>${ing}</h3>
      <p>Stock: <span class="stockValue">${stockActual}</span> ${stockActual%1===0?"ud":"g"}</p>
      <span class="days">${diasRestantes}d</span>
      <input type="number" value="${stockActual}" />
    `;
    const input = card.querySelector("input");
    const stockValue = card.querySelector(".stockValue");
    input.addEventListener("input",(e)=>{
      const val=parseFloat(e.target.value);
      if(!isNaN(val)){ stock[ing]=val; stockValue.textContent=val; renderInventario(); }
    });
    gridInventario.appendChild(card);
  }
}
renderInventario();

// --- Cambiar vista para incluir inventario ---
function mostrarVista(vista){
  document.getElementById("vista-etiquetas").style.display=(vista==="etiquetas")?"block":"none";
  document.getElementById("vista-consultar").style.display=(vista==="consultar")?"block":"none";
  document.getElementById("vista-obrador").style.display=(vista==="obrador")?"block":"none";
  document.getElementById("vista-inventario").style.display=(vista==="inventario")?"block":"none";
  if(vista==="inventario") renderInventario();
}

// --- Mantener resto de funciones de generador, obrador y consultar como ya estaban ---
</script>
</body>
</html>
