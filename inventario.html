<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>Inventario ‚Äì Santa Gloria Russafa</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#fff; color:#000; padding-bottom:100px; }
header { background: rgba(255,255,255,0.9); backdrop-filter: blur(8px); color:#000; text-align:center; padding:12px; font-size:1.1em; font-weight:bold; position:sticky; top:0; z-index:999; }
.nav-buttons { margin-top:8px; display:flex; flex-wrap:wrap; gap:6px; justify-content:center; }
.nav-buttons button { padding:6px 12px; border:none; border-radius:6px; background:#fff; color:#000; cursor:pointer; font-size:0.9em; border:1px solid #000; }
.nav-buttons button:hover { background:#eee; }
#buscador { width:250px; padding:8px; border:2px solid #000; border-radius:6px; margin:10px auto; display:block; font-size:0.9em; }
.obrador-container { padding:15px; display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
.obrador-item { border:1px solid #ccc; border-radius:8px; padding:10px; background-color:#fff; width:220px; transition:0.3s; }
.obrador-item h3 { margin:0 0 8px 0; font-size:1.1em; }
.obrador-item p { margin:4px 0; font-size:0.9em; }
.obrador-item button { background:#000; color:#fff; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:0.8em; margin-top:8px; width:100%; }
.obrador-item button:hover { background:#333; }
.verde { background-color:#d4edda; }
.amarillo { background-color:#fff3cd; }
.rojo { background-color:#f8d7da; }

/* Modal */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color: rgba(0,0,0,0.5); }
.modal-content { background-color:#fff; margin:10% auto; padding:20px; border-radius:8px; width:300px; position:relative; }
.modal-content h3 { margin-top:0; font-size:1.2em; }
.modal-content input { width:100%; padding:6px; margin:5px 0; border-radius:6px; border:1px solid #000; font-size:0.9em; background:#fff; color:#000; }
.modal-content button { width:100%; margin-top:10px; background:#000; color:#fff; padding:8px; border:none; border-radius:6px; cursor:pointer; font-size:0.9em; }
.modal-content button:hover { background:#333; }
.close { position:absolute; top:10px; right:15px; font-size:20px; cursor:pointer; }
</style>
</head>
<body>

<header>
  Inventario ‚Äì Santa Gloria Russafa
  <input type="text" id="buscador" placeholder="Buscar producto...">
  <div class="nav-buttons">
    <button onclick="filtrarCategoria('')">Todos</button>
    <button onclick="filtrarCategoria('Quesos')">Quesos</button>
    <button onclick="filtrarCategoria('Dulces')">Dulces</button>
    <button onclick="filtrarCategoria('Embutidos')">Embutidos</button>
    <button onclick="filtrarCategoria('Ensaladas')">Ensaladas</button>
    <button onclick="filtrarCategoria('Frutas y Verduras')">Frutas y Verduras</button>
    <button onclick="filtrarCategoria('Pan')">Pan</button>
    <button onclick="filtrarCategoria('Cremas y Salsas')">Cremas y Salsas</button>
    <button onclick="filtrarCategoria('Tartas')">Tartas</button>
    <button onclick="filtrarCategoria('Otros')">Otros</button>
    <button onclick="agregarProducto()">‚ûï Agregar</button>
    <button onclick="descargarJSON()">‚¨áÔ∏è Descargar JSON</button>
  </div>
</header>

<main class="obrador-container" id="grid"></main>

<!-- Modal para editar producto -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="cerrarModal()">&times;</span>
    <h3>Editar Producto</h3>
    <label>Nombre:</label>
    <input type="text" id="edit-nombre" disabled>
    <label>Cantidad total:</label>
    <input type="number" id="edit-cantidad" min="0">
    <label>Cantidad diaria:</label>
    <input type="number" id="edit-uso-cantidad" min="0">
    <label>Peso total (kg):</label>
    <input type="number" id="edit-peso" min="0" step="0.01">
    <label>Peso diario (kg):</label>
    <input type="number" id="edit-uso-peso" min="0" step="0.01">
    <button onclick="guardarEdicion()">üíæ Guardar</button>
  </div>
</div>

<script src="inventario.js"></script>
<script src="app.js"></script>
<script>
let currentCategoria = '';
let productoActual = null;

const buscador = document.getElementById('buscador');
buscador.addEventListener('input', () => filtrarCategoria(currentCategoria, buscador.value));

function filtrarCategoria(categoria, filtro='') {
  currentCategoria = categoria;
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  const categorias = categoria ? { [categoria]: data[categoria] } : data;
  const filtroLower = filtro.toLowerCase();

  for (const cat in categorias) {
    categorias[cat].forEach(p => {
      if (!filtro || p.nombre.toLowerCase().includes(filtroLower)) {
        let dias = null;
        if (p.uso_diario_cantidad && p.cantidad_disponible) dias = Math.floor(p.cantidad_disponible / p.uso_diario_cantidad);
        else if (p.uso_diario_peso && p.peso_disponible) dias = Math.floor(p.peso_disponible / p.uso_diario_peso);

        let colorClass = '';
        if (dias !== null) {
          if (dias < 2) colorClass = 'rojo';
          else if (dias === 3) colorClass = 'amarillo';
          else if (dias > 4) colorClass = 'verde';
        }

        const div = document.createElement('div');
        div.className = `obrador-item ${colorClass}`;
        div.innerHTML = `
          <h3>${p.nombre}</h3>
          <p>Cantidad: ${p.cantidad_disponible ?? '-'} (diaria: ${p.uso_diario_cantidad ?? '-'})</p>
          <p>Peso: ${p.peso_disponible ?? '-'} kg (diaria: ${p.uso_diario_peso ?? '-'})</p>
          <p>D√≠as restantes: ${dias ?? '-'}</p>
          <button onclick="abrirModal('${cat}','${p.nombre}')">‚úèÔ∏è Editar</button>
        `;
        grid.appendChild(div);
      }
    });
  }
}

// Modal
function abrirModal(categoria, nombre) {
  productoActual = data[categoria].find(p => p.nombre === nombre);
  if (!productoActual) return;
  document.getElementById('edit-nombre').value = productoActual.nombre;
  document.getElementById('edit-cantidad').value = productoActual.cantidad_disponible ?? '';
  document.getElementById('edit-uso-cantidad').value = productoActual.uso_diario_cantidad ?? '';
  document.getElementById('edit-peso').value = productoActual.peso_disponible ?? '';
  document.getElementById('edit-uso-peso').value = productoActual.uso_diario_peso ?? '';
  document.getElementById('modal').style.display = 'block';
}

function cerrarModal() { document.getElementById('modal').style.display = 'none'; }

function guardarEdicion() {
  if (!productoActual) return;
  productoActual.cantidad_disponible = parseFloat(document.getElementById('edit-cantidad').value) || 0;
  productoActual.uso_diario_cantidad = parseFloat(document.getElementById('edit-uso-cantidad').value) || 0;
  productoActual.peso_disponible = parseFloat(document.getElementById('edit-peso').value) || 0;
  productoActual.uso_diario_peso = parseFloat(document.getElementById('edit-uso-peso').value) || 0;
  cerrarModal();
  filtrarCategoria(currentCategoria, buscador.value);
}
</script>
</body>
</html>
