<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario – Santa Gloria Russafa</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#fff; color:#000; padding-bottom:100px; }
header { background: rgba(255,255,255,0.9); color:#000; text-align:center; padding:12px; font-size:1.2em; font-weight:bold; position:sticky; top:0; z-index:999; }
.nav-buttons { margin-top:8px; display:flex; flex-wrap:wrap; justify-content:center; gap:6px; }
.nav-buttons button { padding:6px 12px; border:none; border-radius:6px; background:#fff; color:#000; cursor:pointer; font-size:0.9em; border:1px solid #000; }
.nav-buttons button.active { background:#000; color:#fff; }
.nav-buttons button:hover { background:#eee; }
#buscador { width:90%; margin:10px auto; display:block; padding:8px 12px; border-radius:6px; border:2px solid #000; font-size:1em; }
#grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:12px; padding:15px; }

.obrador-item { 
  border:1px solid #000; 
  border-radius:8px; 
  padding:12px; 
  background:#fff; 
  position:relative; 
  display:flex; 
  flex-direction:column; 
  justify-content:space-between; 
  overflow:hidden;
}
.obrador-item h3 { margin:0 0 6px 0; font-size:1.1em; }
.obrador-item p { margin:2px 0; font-size:0.9em; }
.obrador-item .dias-restantes { 
  position:absolute; 
  top:8px; 
  right:8px; 
  font-weight:bold; 
  font-size:0.9em; 
  background:#000; 
  color:#fff; 
  padding:2px 6px; 
  border-radius:4px;
}
.obrador-item button { 
  background:#000; 
  color:#fff; 
  border:none; 
  padding:6px 10px; 
  border-radius:4px; 
  cursor:pointer; 
  font-size:0.85em; 
  margin-top:8px; 
}
.obrador-item button:hover { background:#333; }

/* Borde izquierdo visible y grueso */
.obrador-item::before { 
  content:''; 
  position:absolute; 
  left:0; 
  top:0; 
  width:14px; 
  height:100%; 
  border-radius:0 8px 8px 0; 
  background:#ccc; 
}

/* Modal */
#modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); align-items:center; justify-content:center; z-index:1000; }
.modal-content { background:#fff; padding:20px; border-radius:8px; width:90%; max-width:420px; box-shadow:0 3px 6px rgba(0,0,0,0.2); display:flex; flex-direction:column; gap:10px; }
.modal-content h2 { margin:0; text-align:center; }
.modal-content label { font-weight:bold; font-size:0.9em; }
.modal-content input { padding:8px; border:1px solid #000; border-radius:6px; width:100%; }
.modal-content button { background:#000; color:#fff; border:none; padding:10px; border-radius:6px; cursor:pointer; margin-top:10px; }
.modal-content button:hover { background:#333; }
</style>
</head>
<body>

<header>
  Inventario – Santa Gloria Russafa
  <div class="nav-buttons">
    <button onclick="filtrarCategoria('')" class="active">Todos</button>
    <button onclick="filtrarCategoria('Quesos')">Quesos</button>
    <button onclick="filtrarCategoria('Dulces')">Dulces</button>
    <button onclick="filtrarCategoria('Embutidos')">Embutidos</button>
    <button onclick="filtrarCategoria('Ensaladas')">Ensaladas</button>
    <button onclick="filtrarCategoria('Frutas y Verduras')">Frutas y Verduras</button>
    <button onclick="filtrarCategoria('Pan')">Pan</button>
    <button onclick="filtrarCategoria('Cremas y Salsas')">Cremas y Salsas</button>
    <button onclick="filtrarCategoria('Tartas')">Tartas</button>
    <button onclick="filtrarCategoria('Otros')">Otros</button>
  </div>
  <input type="text" id="buscador" placeholder="Buscar producto...">
</header>

<main id="grid"></main>

<!-- Modal actualización -->
<div id="modal">
  <div class="modal-content">
    <h2 id="modalNombre"></h2>
    <label>Cantidad total</label>
    <input type="number" id="modalCantidadTotal">
    <label>Peso total</label>
    <input type="number" id="modalPesoTotal">
    <label>Cantidad disponible</label>
    <input type="number" id="modalCantidadDisponible">
    <label>Peso disponible</label>
    <input type="number" id="modalPesoDisponible">
    <label>Uso diario (cantidad)</label>
    <input type="number" id="modalUsoCantidad">
    <label>Uso diario (peso)</label>
    <input type="number" id="modalUsoPeso">
    <button onclick="guardarCambios()">Guardar</button>
  </div>
</div>

<script src="inventario.js"></script>
<script>
let inventario = JSON.parse(localStorage.getItem('inventario'));
if(!inventario){
    inventario = productos; 
    localStorage.setItem('inventario', JSON.stringify(inventario));
}

let productoActual = null;

function calcularDias(item){
    let dias = null;
    if(item.cantidad_disponible != null && item.uso_diario_cantidad != null && item.uso_diario_cantidad>0)
        dias = item.cantidad_disponible / item.uso_diario_cantidad;
    else if(item.peso_disponible != null && item.uso_diario_peso != null && item.uso_diario_peso>0)
        dias = item.peso_disponible / item.uso_diario_peso;
    return dias;
}

function renderizarInventario(filtroCategoria='', busqueda=''){
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    Object.values(inventario).flat().forEach(item=>{
        if(filtroCategoria && item.categoria!==filtroCategoria) return;
        if(busqueda && !item.nombre.toLowerCase().includes(busqueda.toLowerCase())) return;

        const dias = calcularDias(item);
        let colorBorde = '#ccc';
        if(dias !== null){
            if(dias < 2) colorBorde = '#ff0000';
            else if(dias <=3) colorBorde = '#ffcc00';
            else colorBorde = '#00cc00';
        }

        const div = document.createElement('div');
        div.className = 'obrador-item';
        div.style.setProperty('--colorBorde', colorBorde);
        div.style.setProperty('border-left', `14px solid ${colorBorde}`);

        div.innerHTML = `
            <h3>${item.nombre}</h3>
            <span class="dias-restantes">${dias !== null ? dias.toFixed(1)+' días':'N/A'}</span>
            <p><b>Cant. total:</b> ${item.cantidad_caja ?? '-'}</p>
            <p><b>Peso total:</b> ${item.peso_caja ?? '-'}</p>
            <p><b>Cant. disponible:</b> ${item.cantidad_disponible ?? '-'}</p>
            <p><b>Peso disponible:</b> ${item.peso_disponible ?? '-'}</p>
            <p><b>Uso diario (cant):</b> ${item.uso_diario_cantidad ?? '-'}</p>
            <p><b>Uso diario (peso):</b> ${item.uso_diario_peso ?? '-'}</p>
            <button onclick="abrirModal('${item.nombre}')">Actualizar</button>
        `;
        grid.appendChild(div);
    });
}

function abrirModal(nombre){
    productoActual = Object.values(inventario).flat().find(i=>i.nombre===nombre);
    if(!productoActual) return;
    document.getElementById('modalNombre').textContent = productoActual.nombre;
    document.getElementById('modalCantidadTotal').value = productoActual.cantidad_caja ?? '';
    document.getElementById('modalPesoTotal').value = productoActual.peso_caja ?? '';
    document.getElementById('modalCantidadDisponible').value = productoActual.cantidad_disponible ?? '';
    document.getElementById('modalPesoDisponible').value = productoActual.peso_disponible ?? '';
    document.getElementById('modalUsoCantidad').value = productoActual.uso_diario_cantidad ?? '';
    document.getElementById('modalUsoPeso').value = productoActual.uso_diario_peso ?? '';
    document.getElementById('modal').style.display = 'flex';
}

function guardarCambios(){
    if(!productoActual) return;
    productoActual.cantidad_caja = Number(document.getElementById('modalCantidadTotal').value) || null;
    productoActual.peso_caja = Number(document.getElementById('modalPesoTotal').value) || null;
    productoActual.cantidad_disponible = Number(document.getElementById('modalCantidadDisponible').value) || null;
    productoActual.peso_disponible = Number(document.getElementById('modalPesoDisponible').value) || null;
    productoActual.uso_diario_cantidad = Number(document.getElementById('modalUsoCantidad').value) || null;
    productoActual.uso_diario_peso = Number(document.getElementById('modalUsoPeso').value) || null;

    localStorage.setItem('inventario', JSON.stringify(inventario));
    document.getElementById('modal').style.display = 'none';
    renderizarInventario(document.querySelector('.nav-buttons .active')?.textContent || '', document.getElementById('buscador').value);
}

function filtrarCategoria(categoria){
    document.querySelectorAll('.nav-buttons button').forEach(btn=>btn.classList.remove('active'));
    if(categoria) Array.from(document.querySelectorAll('.nav-buttons button')).find(b=>b.textContent===categoria)?.classList.add('active');
    renderizarInventario(categoria, document.getElementById('buscador').value);
}

document.getElementById('buscador').addEventListener('input', e=>{
    renderizarInventario(document.querySelector('.nav-buttons .active')?.textContent || '', e.target.value);
});

document.getElementById('modal').addEventListener('click', e=>{
    if(e.target.id==='modal') document.getElementById('modal').style.display='none';
});

renderizarInventario();
</script>
</body>
</html>
